const BOT = require('./vk')

const Intl = require('intl')
const moment = require('moment')
const Time = new Date()
const formatter = new Intl.DateTimeFormat('ru', {
  month: 'long',
  day: 'numeric'
})

moment().format()

// CÐ¾Ð·Ð´Ð°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€
require('http').createServer().listen(process.env.PORT || 8000).on('request', function(request, res) {
  res.end('')
})

BOT.MESSAGES.hear('/start', async (context) => {
  await context.send(`ÐŸÑ€Ð¸Ð²ÐµÑ‚! ðŸ‘‹
ðŸ¤– Ð¯ - Ð‘Ð¾Ñ‚, ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ ${BOT.CONFIG.className} ${BOT.CONFIG.schoolName}. Ð¯ Ð½Ð°Ð´ÐµÑŽÑÑŒ, Ñ‡Ñ‚Ð¾ Ð±ÑƒÐ´Ñƒ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ð¾Ð»ÐµÐ·ÐµÐ½ Ð²Ð°Ð¼, Ð¸ Ð²Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ð½ÐµÐ·Ð°Ð±Ñ‹Ð²Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ð¿Ñ‹Ñ‚ â˜ºï¸. ÐŸÐ¾ÑÐºÐ¾Ð»ÑŒÐºÑƒ Ñ Ð¼Ð¾Ð³Ñƒ Ð¼Ð½Ð¾Ð³Ð¾Ðµ, Ñ Ð¿Ñ€Ð¸Ð²Ð¾Ð¶Ñƒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ð¼Ð¾Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´:

/Ð´Ð°Ñ‚Ð° - ÑƒÐ·Ð½Ð°Ð¹ Ð´Ð· Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð´Ð· Ð·Ð°Ð²Ñ‚Ñ€Ð° - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð¸Ð³Ñ€Ñ‹ - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼ Ð¸Ð³Ñ€ (Ð´Ð°-Ð´Ð°, Ð½Ðµ ÑƒÐ´Ð¸Ð²Ð»ÑÐ¹Ñ‚ÐµÑÑŒ)
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð½ÐµÐ´ÐµÐ»Ñ - Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½Ð° Ð²ÑÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/ÑˆÐ¿Ð¾Ñ€Ð° - Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹ Ð²Ð°Ð¶Ð½Ñ‹Ðµ Ñ„Ð¾Ñ‚Ð¾/Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹/ÑˆÐ¿Ð¾Ñ€Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾ Ð²ÑÐµÐ¹ Ð±ÐµÑÐµÐ´Ðµ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ - ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ð¼Ð¾Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/help - Ð¼Ð¾Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ`)
})

BOT.MESSAGES.hear('/Ð·Ð°Ð²Ñ‚Ñ€Ð°', async (context) => {
  for (i = 0; i < 7; i++) {
      if (moment().day() === i) {
          if (is11A === true) {
              await context.send(`Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°: \n${Schedule[i].map(({a11}) => a11).join('')}`)
          } else {
              await context.send(`Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°: \n${Schedule[i].map(({b11}) => b11).join('')}`)
          }
      }
  }
})

BOT.MESSAGES.hear('/help', async (context) => {
  await context.send(`Ð˜Ñ‚Ð°Ðº, Ð²Ð¾Ñ‚ Ð²Ð°Ð¼ Ð±Ð¾Ð»ÐµÐµ-Ð¼ÐµÐ½ÐµÐµ ÐºÑ€Ð°Ñ‚ÐºÐ°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ.
ÐœÐ¾Ð¹ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ð¹ ÐºÐ¾Ð´: https://github.com/sashafromlibertalia/SchoolBot

ÐšÑ€Ð°Ñ‚ÐºÐ°Ñ ÑÐ²Ð¾Ð´ÐºÐ° Ð¿Ð¾ Ð¼Ð¾Ð¸Ð¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼: /start

ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¸Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð²Ñ‹Ð·Ð²Ð°Ð½Ñ‹ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¼Ð¸ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑÐ¼Ð¸. ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚? ÐŸÑ€Ð¾ÑÑ‚Ð¾! 
Ð¯ Ð´ÐµÐ»Ð°ÑŽ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ Ð½Ð° Ñ‚Ð¾ Ð¸Ð»Ð¸ Ð¸Ð½Ð¾Ðµ ÑÐ»Ð¾Ð²Ð¾, Ð° Ð±Ð¾Ñ‚ Ð½Ð° Ð½ÐµÐ³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚.

ÐšÐÐš Ð ÐÐ‘ÐžÐ¢ÐÐ•Ð¢ /Ð³Ð´Ð·:
Ð’Ñ‹ Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ "/Ð³Ð´Ð·" Ð¸ ÑÐ»ÐµÐ´Ð¾Ð¼ Ñ‚ÐµÐºÑÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸. ÐŸÑ€Ð¸Ð¼ÐµÑ€:
/Ð³Ð´Ð· Ð˜Ð· Ð´Ð²ÑƒÑ… Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½Ð° Ð²ÑÑ‚Ñ€ÐµÑ‡Ñƒ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ñƒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¸ÑÑŒ Ð´Ð²Ð° Ð¿Ð¾ÐµÐ·Ð´Ð°. 

Ð¡Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒÑÑ, ÐµÑÐ»Ð¸ Ð²Ñ‹ Ð¾Ð± ÑÑ‚Ð¾Ð¼ Ð¼ÐµÐ½Ñ Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ðµ Ð¸ ÐµÑÐ»Ð¸ Ð² ÑÑ‚Ð¾Ð¼ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð²ÑÑÐºÐ¸Ð¹ ÑÐ¼Ñ‹ÑÐ»`)
})

BOT.MESSAGES.hear('/ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹', async (context) => {
  await context.send(`Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ð¼Ð¾Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´:
  /Ð´Ð°Ñ‚Ð° - ÑƒÐ·Ð½Ð°Ð¹ Ð´Ð· Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð´Ð· - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð´Ð½Ñ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð´Ð· Ð·Ð°Ð²Ñ‚Ñ€Ð° - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð´Ð· Ð²ÑÐµ - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ Ð½Ð° Ð²ÑÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð¸Ð³Ñ€Ñ‹ - Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ð¼ Ð¸Ð³Ñ€ (Ð´Ð°-Ð´Ð°, Ð½Ðµ ÑƒÐ´Ð¸Ð²Ð»ÑÐ¹Ñ‚ÐµÑÑŒ)
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð½ÐµÐ´ÐµÐ»Ñ - Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½Ð° Ð²ÑÑŽ Ð½ÐµÐ´ÐµÐ»ÑŽ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/Ð¾Ñ‚Ð·Ñ‹Ð² - Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¾Ñ‚Ð·Ñ‹Ð², Ð¸ Ð¡Ð°ÑˆÐ° ÐµÐ³Ð¾ ÑƒÐ²Ð¸Ð´Ð¸Ñ‚. Ð’ÐÐ–ÐÐž: Ð¾Ñ‚Ð·Ñ‹Ð² Ð°Ð½Ð¾Ð½Ð¸Ð¼ÐµÐ½ 
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/ÑˆÐ¿Ð¾Ñ€Ð° - Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹ Ð²Ð°Ð¶Ð½Ñ‹Ðµ Ñ„Ð¾Ñ‚Ð¾/Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹/ÑˆÐ¿Ð¾Ñ€Ñ‹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾ Ð²ÑÐµÐ¹ Ð±ÐµÑÐµÐ´Ðµ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/ÑˆÐ¿Ð¾Ñ€Ð° ÑÐ¿Ð¸ÑÐ¾Ðº - ÑÐ¿Ð¸ÑÐ¾Ðº ÑˆÐ¿Ð¾Ñ€
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/ÑˆÐ¿Ð¾Ñ€Ð° ? - Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/citgen - Ð¿ÐµÑ€ÐµÑˆÐ»Ð¸Ñ‚Ðµ Ñ‡ÑŒÐµ-Ñ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÑ‚Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
/help - Ð¼Ð¾Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

Ð‘Ð¾Ñ‚, ÐºÑÑ‚Ð°Ñ‚Ð¸, ÑÐ°Ð¼ ÑƒÐ¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ð·ÑƒÐ¼!`)
})

BOT.MESSAGES.hear(/^\/Ð¾Ñ‚Ð·Ñ‹Ð² (.+)/i, async (context) => {
  const feedback = context.$match[1]
  await context.send(`Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾, Ñ‚Ð²Ð¾Ð¹ Ð¾Ñ‚Ð·Ñ‹Ð² Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ ${BOT.CONFIG.adminNameDat}, ÑÐ¿Ð°ÑÐ¸Ð±Ð¾ :)`)
  api.messages.send({
      message: 'ÐÐžÐ’Ð«Ð™ ÐžÐ¢Ð—Ð«Ð’: ' + feedback,
      domain: BOT.CONFIG.adminDomain
  })
})

BOT.MESSAGES.hear('/Ð½ÐµÐ´ÐµÐ»Ñ', async (context) => {
  if (is11A === true) {
      await context.send(`Ð ÐÐ¡ÐŸÐ˜Ð¡ÐÐÐ˜Ð• ÐÐ Ð’Ð¡Ð® ÐÐ•Ð”Ð•Ð›Ð®:
ÐŸÐžÐÐ•Ð”Ð•Ð›Ð¬ÐÐ˜Ðš:
${Schedule[0].map(({a11}) => a11).join('')}

Ð’Ð¢ÐžÐ ÐÐ˜Ðš:
${Schedule[1].map(({a11}) => a11).join('')}

Ð¡Ð Ð•Ð”Ð:
${Schedule[2].map(({a11}) => a11).join('')}

Ð§Ð•Ð¢Ð’Ð•Ð Ð“:
${Schedule[3].map(({a11}) => a11).join('')}

ÐŸÐ¯Ð¢ÐÐ˜Ð¦Ð:
${Schedule[4].map(({a11}) => a11).join('')}

Ð¡Ð£Ð‘Ð‘ÐžÐ¢Ð:
${Schedule[5].map(({a11}) => a11).join('')}`)
  } else {
      await context.send(`Ð ÐÐ¡ÐŸÐ˜Ð¡ÐÐÐ˜Ð• ÐÐ Ð’Ð¡Ð® ÐÐ•Ð”Ð•Ð›Ð®:
ÐŸÐžÐÐ•Ð”Ð•Ð›Ð¬ÐÐ˜Ðš:
${Schedule[0].map(({b11}) => b11).join('')}

Ð’Ð¢ÐžÐ ÐÐ˜Ðš:
${Schedule[1].map(({b11}) => b11).join('')}

Ð¡Ð Ð•Ð”Ð:
${Schedule[2].map(({b11}) => b11).join('')}

Ð§Ð•Ð¢Ð’Ð•Ð Ð“:
${Schedule[3].map(({b11}) => b11).join('')}

ÐŸÐ¯Ð¢ÐÐ˜Ð¦Ð:
${Schedule[4].map(({b11}) => b11).join('')}

Ð¡Ð£Ð‘Ð‘ÐžÐ¢Ð:
${Schedule[5].map(({b11}) => b11).join('')}`)
  }
})


BOT.VK.updates.start().catch(console.error);